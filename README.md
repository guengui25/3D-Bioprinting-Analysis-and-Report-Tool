# 3D Bioprinting Analysis and Report Tool

A comprehensive application for analyzing 3D bioprinted structures through G-code processing and image analysis. This tool helps researchers and engineers evaluate print quality, measure line widths, compare designs to actual prints, and generate detailed reports.

## Table of Contents

- [Overview](#overview)
- [Key Features](#key-features)
- [System Requirements](#system-requirements)
- [Installation](#installation)
- [Usage](#usage)
  - [G-code Processing](#g-code-processing)
  - [Image Analysis](#image-analysis)
  - [Working with Reports](#working-with-reports)
- [Workflow](#workflow)
- [Project Structure](#project-structure)
- [Technical Details](#technical-details)
- [Limitations](#limitations)

## Overview

The 3D Bioprinting Analysis and Report Tool provides an integrated environment for evaluating the quality of 3D bioprinted structures by comparing the original G-code instructions against actual printed results. The application processes G-code files to extract printing trajectories, analyzes photographs of the printed objects, overlays the intended paths onto the actual results, and generates comprehensive reports with detailed metrics about print accuracy.

> **Note:** Currently, the tool only supports G-code files generated by PrusaSlicer.

## Key Features

### G-code Processing
- **G-code File Parsing**: Extract printing paths and layer information from G-code files
- **Intelligent Perimeter Detection**: Automatically identify and optionally filter out the outer perimeter of prints
- **Layer-by-Layer Visualization**: Create visualizations of each layer with current line highlighting
- **Scale Detection**: Automatically determine the scale factor based on nozzle diameter settings
- **Sequential Image Generation**: Create time-lapse style image sequences showing the print process

### Image Processing
- **Automatic Scale Detection**: Identify scaling information from reference elements in photographs
- **Distortion Correction**: Detect and compensate for camera lens distortion
- **3D Figure Segmentation**: Automatically extract the printed object from background elements
- **G-code Overlay**: Precisely map G-code paths onto the processed image
- **Accumulation GIF Generation**: Create animated visualizations of the printing process

### Analysis and Metrics
- **Line Width Measurement**: Calculate precise measurements of printed line widths
- **Width Variation Analysis**: Determine consistency of line thickness throughout the print
- **Error Detection**: Identify lines that cross contours or have irregular widths
- **Statistical Analysis**: Generate comprehensive statistics on print accuracy
- **Contour Detection**: Identify both external and internal contours for dimensional analysis
- **Sample-Based Analysis**: Configurable number of sample points for detailed width measurements

### Report Generation
- **Comprehensive PDF Reports**: Generate detailed reports including all analysis metrics
- **Visualization Images**: Include processed images showing analysis results
- **Comparative Tables**: Present accurate measurements alongside expected values
- **Error Highlighting**: Visually identify problematic print areas with color coding
- **Appendices with Line Details**: Include individual line analysis with measurements

### Printable Templates
- **Reference Templates**: Generate printable PDF templates with calibration elements
- **Scale References**: Include precise rulers and reference cards for accurate scale detection
- **Multiple Variants**: Both white and black background versions for different materials
- **Optimized Photography Guidance**: Instructions for proper camera positioning

> **See** [Printable Templates Documentation](docs/printable_templates.md)

### User Interface
- **Intuitive Tabbed Interface**: Separate tabs for G-code and image processing
- **Integrated Console Output**: View processing information directly in the application
- **File and Directory Selection**: Easy file browsing with dialog windows
- **Configurable Processing Options**: Customize analysis parameters
- **Concurrent Processing**: Background processing with progress indicators
- **Status Monitoring**: Real-time status updates during analysis

## System Requirements

- **Operating System**: Windows, macOS, or Linux
- **Python**: Python 3.12.10
- **Disk Space**: Minimum 900MB for installation and additional space for output files
- **RAM**: Minimum 4GB, 8GB+ recommended for larger files
- **Required Software**: [Tesseract OCR](https://tesseract-ocr.github.io/tessdoc/Installation.html) (for OCR in the scale text detection)

## Installation

1. Clone or download the repository:
   ```bash
   git clone https://github.com/guengui25/3D-Bioprinting-Analysis-and-Report-Tool
   ```

2. Navigate to the project directory:
   ```bash
   cd "3D Bioprinting Analysis and Report Tool"
   ```

3. Install required dependencies:
   ```bash
   pip install -r requirements.txt
   ```

4. Ensure Tesseract OCR is installed on your system:
   - Windows: Download and install from [GitHub](https://github.com/tesseract-ocr/tesseract)
   - macOS: `brew install tesseract`
   - Linux: `sudo apt install tesseract-ocr`

5. Run the application:
   ```
   python run_app.py
   ```

## Usage

### G-code Processing

1. In the "G-Code Processing" tab, click "Browse..." to select a G-code file
2. Specify an output folder or use the default
3. Configure processing options:
   - Toggle "Skip Perimeter" to filter out the outer perimeter (recommended)
   - Adjust "Perimeter %" to control how much of the initial segments to filter
   - Enable "Limit Layers" and set "Max Layers" to process only specific layers
4. Click "Process G-Code" to start analysis
5. The console output will show progress and results
6. Upon completion, the G-code directory will be automatically set for image processing

### Image Analysis

1. In the "Image Processing" tab, click "Browse..." to select an image of your 3D print
2. Either use the automatically populated G-code Images Directory or browse for a different one
3. Specify an output directory for the analysis results
4. Configure processing options:
   - Toggle "Save Analysis Images" to save individual line analysis visualizations
   - Enable/disable "Generate GIF" for animated process visualization
   - Choose whether to "Generate PDF Report" with detailed analysis
   - Configure sample points for width measurements with "Number of samples"
5. Click "Process Image" to start the analysis
6. Monitor progress in the console output
7. Upon completion, a success message will display the output directory

### Working with Reports

1. Navigate to the output directory specified during image processing
2. Open the PDF report (`analysis_report_*.pdf`) to view detailed analysis results
3. The report contains:
   - General information about the print and analysis
   - Statistical summary of line measurements
   - Visualization of the processing steps
   - Detailed tables with width measurements
   - Appendix with individual line analysis images
4. CSV files with raw measurement data are also available in the `line_analysis` folder

## Workflow

1. **Prepare the print**: Print your 3D structure using a printer
2. **Capture image**: Photograph the printed result using the [printable template](#printable-templates) as reference
3. **Process G-code**: Extract the printing paths from the G-code file and turn them into a visual representation
4. **Analyze image**: Process the photograph to detect, correct, and segment the printed structure
5. **Generate overlay**: Map the G-code paths onto the processed image
6. **Analyze results**: Calculate metrics about line widths and print accuracy
7. **Review report**: Examine the PDF report for detailed analysis and visualizations

> **See an output example** [here](aux/sample_data/output_sample)

## Project Structure

The project is organized into the following directory structure:

```
3D Bioprinting Analysis and Report Tool/
├── app/                          # Main application code
│   ├── functions/                  # Core functionality modules
│   │   ├── figure_detection/       # Segment 3D printed objects
│   │   │   └── figure_detection.py       # Segment 3D printed objects
│   │   ├── fix_distorsion/         # Correct image distortion
│   │   │   └── fix_distorsion.py         # Correct image distortion
│   │   ├── overlay_gcode/          # G-code processing functions
│   │   │   ├── overlay_lines.py          # Overlay G-code lines on images
│   │   │   └── scale_gcode.py            # Handle G-code scaling
│   │   ├── reporting/                 # Report generation
│   │   │   └── pdf_generator.py          # Generate PDF reports
│   │   ├── scale_detection/           # Detect scale
│   │   │   └── scale_ruler.py            # Detect scale from rulers
│   │   └── width_detection/           # Detect line widths and generate metrics
│   │       ├── analyze_lines.py          # Line width measurement
│   │       └── metrics_exporter.py       # Export analysis metrics
│   ├── app_gui.py                  # Main GUI implementation
│   ├── main_gcode.py               # G-code processing workflow
│   └── main_mask.py                # Image processing workflow
├── aux/                          # Auxiliary files and resources
│   ├── sample_data/                  # Sample data for testing
│   │   ├── input_sample/                  # Sample G-code and images
│   │   └── output_sample/                 # Sample output files
│   └── template_generation/            # Template generation resources
│      └── printable_template.py       # Create printable reference templates
├── docs/                          # Documentation files
│   ├── printable_templates.md          # Documentation for printable templates
│   └── README_es.md                  # Spanish version of the README
├── logs/                           # Application log files
├── templates/                      # Template files for printing
│   ├── printable_template_black.pdf   # Black background template
│   └── printable_template_white.pdf   # White background template
├── .gitignore                     # Git ignore file
├── README.md                       # Project documentation
├── requirements.txt                # Python dependencies
└── run_app.py                      # Application entry point
```

## Technical Details

### Architecture

The application is modular with these main components:
- **G-code parser**: Extracts printing paths and layer information (currently supports PrusaSlicer format only)
- **Image processor**: Handles image correction, segmentation, and analysis
- **Overlay engine**: Maps G-code paths to image coordinates
- **Analysis module**: Calculates line widths and quality metrics
- **Report generator**: Creates PDF reports with results
- **GUI interface**: Provides user access to all functionality

### Key Files

- `run_app.py`: Main application entry point
- `app_gui.py`: Graphical user interface implementation
- `main_gcode.py`: G-code processing functionality
- `main_mask.py`: Image processing and analysis functionality
- `printable_template.py`: Template generation for photography

## Limitations

- Currently only supports G-code files generated by PrusaSlicer
- Scale detection requires red scale rulers or markers in the image
- Best results are achieved when using the provided printable templates
- Performance may be slower with very large G-code files or high-resolution images
